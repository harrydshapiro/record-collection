# Docker Compose configuration for record-collection
# Run with: docker compose up --build

services:
  # MPD (Music Player Daemon) service
  mpd:
    image: vimagick/mpd:latest
    container_name: record-collection-mpd
    volumes:
      - ./mpd.conf:/etc/mpd.conf:ro
      - ./test-music-lib:/music:ro
      - mpd-data:/var/lib/mpd
    ports:
      - "6600:6600"   # MPD control port
      - "8000:8000"   # HTTP audio stream
    restart: unless-stopped

  # Node.js server serving the React client
  server:
    build:
      context: .
    container_name: record-collection-server
    environment:
      NODE_ENV: production
      MPD_PORT: "6600"
      # MPD runs in separate container, connect via service name
      HOST: mpd
      LIBRARY_ROOT_PATH: /music
    volumes:
      # Mount music library so server can read cover art
      - ./test-music-lib:/music:ro
    ports:
      - "4000:4000"
    depends_on:
      - mpd
    restart: unless-stopped

volumes:
  mpd-data:
